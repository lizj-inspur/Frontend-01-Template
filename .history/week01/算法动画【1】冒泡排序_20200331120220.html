<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>冒泡排序</title>
    <style>
      #warp {
        position: relative;
        height: 200px;
        margin: 50px;
      }
      #warp div {
        position: absolute;
        width: 30px;
        display: inline-block;
        background: pink;
        text-align: center;
        bottom: 0;
        transition: all 0.2s;
      }
      #warp .active {
        background-color: #da4d66;
      }
      #warp .fixed {
        background-color: green;
        color: #fff;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div id="warp"></div>
  </body>
  <script>
    /*
     *  原创作者 ：邓占勇
     *  时间：2020-3-22
     *  说明：使用原始JS实现冒泡排序动画演示
     *  个人网站： www.dzyong.top
     *  微信公众号： 《前端筱园》
     *  CSDN: https://blog.csdn.net/DengZY926
     */

    //创建结构
    var warp = document.getElementById("warp");
    var point = []; //保存所有的节点
    //创建dom类
    let Dom = function(height, left) {
      this.dom = null;
      this.height = height;
      this.left = left;
      this.createDom();
    };
    Dom.prototype = {
      createDom: function() {
        //创建节点
        debugger;
        var ele = document.createElement("div");
        ele.style.height = this.height + "%";
        ele.style.left = this.left;
        ele.innerHTML = `<span>${this.height}</span>`;
        warp.appendChild(ele);
        this.dom = ele;
        return this; //返回this是为可以使用链式调用
      },
      addClass: function(name) {
        //添加样式类
        this.dom.classList.add(name);
        return this;
      },
      removeClass: function(name) {
        //移除样式类
        this.dom.classList.remove(name);
        return this;
      },
      move(position, pixel) {
        //移动位置
        this.dom.style[position] = pixel;
        this.left = pixel;
        return this;
      }
    };

    //交换数组中的两个位置
    Array.prototype.arrExchange = function(p1, p2) {
      let v = this[p1];
      this[p1] = this[p2];
      this[p2] = v;
      return this;
    };
    //操作函数
    let operation = {
      //为当前比较的两个节点添加样式
      compare(x, y) {
        for (let l = 0; l < len; l++) {
          //删除样式类
          point[l].removeClass("active");
        }
        point[x].addClass("active");
        point[y].addClass("active");
      },
      //交换位置
      changePosition(x, y) {
        let left1 = parseInt(point[x].left.replace("px", ""));
        let left2 = parseInt(point[y].left.replace("px", ""));
        point[x].move("left", left1 + 50 + "px");
        point[y].move("left", left2 - 50 + "px");
        point = point.arrExchange(x, y);
      }
    };
    //排序数组
    let array = [55, 75, 83, 33, 94, 49, 40, 28, 42, 37, 68];
    let len = array.length;
    //创建dom
    for (let index = 0; index < array.length; index++) {
      let ele = new Dom(array[index], index * 50 + "px");
      point.push(ele);
    }
    //冒泡排序
    let time = 0;
    for (let j = 0; j < array.length - 1; j++) {
      setTimeout(() => {
        for (let i = 0; i < len - 1 - j; i++) {
          setTimeout(() => {
            operation.compare(i, i + 1); //为当前比较的两个节点改变样式
            if (array[i] > array[i + 1]) {
              //如果前面的值大于后面的值则交换位置
              array = array.arrExchange(i, i + 1);
              setTimeout(() => {
                operation.changePosition(i, i + 1); //改变位置
              }, 200);
            }
            setTimeout(() => {
              if (i == len - 2 - j) {
                point[len - 1 - j].addClass("fixed");
              }
            }, 300);
          }, i * 500);
        }
      }, time);
      time += (len - j) * 500;
    }
  </script>
</html>
